<!DOCTYPE HTML >
<html lang="en">
<meta charset="utf-8">
<head>
	<script src="http://d3js.org/d3.v4.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/topojson/1.6.19/topojson.min.js"></script>
	<script src="https://d3js.org/d3-scale-chromatic.v1.min.js"></script>
	<script src="https://d3js.org/d3-geo-projection.v2.min.js"></script>
	<script
	src="https://code.jquery.com/jquery-3.6.0.js"
	integrity="sha256-H+K7U5CnXl1h5ywQfKtSj8PCmoN9aaq30gDh27Xc0jk="
	crossorigin="anonymous"></script>
	<script src="https://unpkg.com/d3-arrow@0.0.25/dist/d3-arrow.min.js"></script>
	<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">

    <style>
        table, th, td {
        border: 1px solid black;
        border-collapse: collapse;
    }

    td:hover {background-color: #AE0000;}

        .china_route {
            fill: none;
            opacity: 0;
        }

        .india_route {
            fill: none;
            opacity: 0;
        }

        .mexico_route {
            fill: none;
            opacity: 0;
        }

        .russia_route {
            fill: none;
            opacity: 0;
        }

        .syria_route {
            fill: none;
            opacity: 0;
        }

        .bangladesh_route {
            fill: none;
            opacity: 0;
        }

        .ukraine_route {
            fill: none;
            opacity: 0;
        }
    /*	.Country { fill:#59FF00;}*/
        
        svg { background: #43a2ca; }

        .source-port {
            fill: white; 
            stroke: darkgreen; 
            stroke-width: 2px;
        }
        div.tooltip {
            position: absolute;
            text-align: left;
            width: auto;
            height: auto;
            padding: 8px;
            font: 12px monospace;
            background: #0a2538;
            border: #0a2538 1px solid;
            border-radius: 10px;
            pointer-events: none;
            color: white;
        }

        #slider{
            appearance: none;
            width: 1000px;
            height: 25px; /* Specified height */
            background: #d3d3d3; /* Grey background */
            outline: none; /* Remove outline */
            opacity: 0.7; /* Set transparency (for mouse-over effects on hover) */
            transition: opacity .2s;
        }
    </style>
</head>
<body>
    <nav class="navbar navbar-default">
        <div class="container-fluid">
                <ul class="nav navbar-nav">
                    <li><a href="page1.html"><span class="glyphicon glyphicon-object-align-bottom"></span> Flow Map </a></li>
                    <li><a href="page2.html"><span class="glyphicon glyphicon-object-align-bottom"></span> Sunburst </a></li>
                    <li><a href="page3.html"><span class="glyphicon glyphicon-object-align-bottom"></span> Edge bundling Flow
                            Map</a></li>
                </ul>
        </div>
      </nav>
    <form >
        <label for="year">Year (between 1990 and 2020):</label>
        <input type="range" id="slider" name="year" min="1990" max="2020" value="1990" step="5">
         <h4>A.D. <span class="year-label">1990</span></h4>
    </form>
    <div class="col-3">
        <button class="btn btn-success" id="year-play-btn">Play <i class="fas fa-play"></i></button>
        <button class="btn btn-danger" id="clean">Clean</button>
    </div>
    <div id="map"> </div>

	<table>
			<tr>
				<td><button id="button_2020" onclick="update(Russia2020)">2020</button></td>
				<td><button id ="button_2015"onclick="update(Russia2015)">2015</button></td>
				<td><button id ="button_2010"onclick="update(Russia2010)">2010</button></td>
				<td><button id ="button_2005"onclick="update(Russia2005)">2005</button></td>
				<td><button id="button_2000"onclick="update(Russia2000)">2000</button></td>
				<td><button id="button_1995"onclick="update(Russia1995)">1995</button></td>
				<td><button id="button_1990"onclick="update(Russia1990)">1990</button></td>
				<td><button id="clean">Clean</button></td>
			</tr>
	</table>

    <table>
        <tr>
            <td><button id="Top1"onclick="update(Russia1990)">Top1</button></td>
            <td><button id="Top2"onclick="update(Afghanistan1990)">Top2</button></td>
            <td><button id="Top3"onclick="update(India1990)">Top3</button></td>
            <td><button id="Top4"onclick="update(Ukraine1990)">Top4</button></td>
            <td><button id="Top5"onclick="update(Bangladesh1990)">Top5</button></td>
        </tr>
    </table>
    <div class="card bg-light mb-3 mt-3" id="description">
        <div class="card-header">
            <span class="h5 card-title">世界移民人口變化圖</span>
        </div>
        <div class="card-body">
            <p class="card-text">
                操作說明<br>
                下方的時間軸可以使用滑鼠拖拉，在1990至2020年間的資料切換。Play鈕可以用動畫的方式顯示1990至2020年的變化。
                <br>Clean按鈕可以清空地圖。按鈕則可以自行選取不同年代做疊圖比較。
                <br><br>
                圖片說明<br>
                呈現各國之間的移民路徑，線條粗細代表移民人數多寡。若線條為紅色，代表該移民路徑女性多於男性；藍色則代表該移民路徑男性多於女性。<br>黃點代表移民輸出國，橘點代表該年前五名移民輸出國，箭頭為移民方向，黑點代表輸入國。國家顏色深淺代表該國GDP高低。
                
                <br><br>
                圖片分析<br>
                可以由歷年移民觀察出趨勢，90年代蘇聯瓦解、中東局部戰爭造就移民潮。2000年後，中國、印度崛起造就大量移民潮。<br>中國的移民主要趨勢為歐美，而印度和孟加拉則移民至西亞。加勒比海地區開始出現大量移民前往美國。2015後，敘利亞內戰造成難民移民至鄰近各國，成為新的移民潮。
            </p>
        </div>
    </div>
    <div id="my_dataviz"></div> 

	<script>
		//jquery part
		$(document).ready(function(){
			//big rectangle listener
            $('#year-play-btn').on('click', function() {
		console.log("play")
		var MIN_YEAR = 1985;
		var MAX_YEAR = 2020;
		let year = MIN_YEAR;
		let slider = $('#slider');
		let playBtn = $(this);
		let interval = 3000;

		playBtn.prop('disabled', true);
		let timer = setInterval( ()=> {
			console.log(year);
			year=year+4;
			slider.val(year);
			slider.trigger('input');
		if( ++year > MAX_YEAR ) clearInterval(timer);
		}, interval);
		setTimeout( () => {
			playBtn.prop('disabled', false);
		}, 22000 );
		console.log("over")
		});


		$('#slider').on('input', function() {
		let year = $(this).val();
		$('.year-label').text(year);
		console.log(year);
		if (year==1990){
			clean();
			show_1990(0,45);
		}
		else if (year==1995){
			clean();
			show_1995(0,52);
		}
		else if (year==2000){
			clean();
			show_2000(0,56);
		}
		else if (year==2005){
			clean();
			show_2005(0,63);
		}
		else if (year==2010){
			clean();
			show_2010(0,79);
		}
		else if (year==2015){
			clean();
			show_2015(0,91);
		}
		else if (year==2020){
			clean();
			show_2020(0,107);
		}
	});
			$('#button_2020').on('click',function(){
				show_2020(0,107);
                document.getElementById("Top1").innerHTML="India";
                document.getElementById("Top2").innerHTML="Mexico";
                document.getElementById("Top3").innerHTML="Russia";
                document.getElementById("Top4").innerHTML="China";
                document.getElementById("Top5").innerHTML="Syria";
                $('#Top1').click(function(){
                    update(India2020);
                });
                $('#Top2').click(function(){
                    update(Mexico2020);
                });
                $('#Top3').click(function(){
                    update(Russia2020);
                });
                $('#Top4').click(function(){
                    update(China2020);
                });
                $('#Top5').click(function(){
                    update(Syria2020);
                });
			});

			//small rectangle listener
			$('#button_2015').click(function(){
				show_2015(0,91);
                document.getElementById("Top1").innerHTML="India";
                document.getElementById("Top2").innerHTML="Mexico";
                document.getElementById("Top3").innerHTML="China";
                document.getElementById("Top4").innerHTML="Russia";
                document.getElementById("Top5").innerHTML="Bangladesh";
                $('#Top1').click(function(){
                    update(India2015);
                });
                $('#Top2').click(function(){
                    update(Mexico2015);
                });
                $('#Top3').click(function(){
                    update(China2015);
                });
                $('#Top4').click(function(){
                    update(Russia2015);
                });
                $('#Top5').click(function(){
                    update(Bangladesh2015);
                });
			});

			//fill small rectangle listener
			$('#button_2010').click(function(){
				show_2010(0,79);
                document.getElementById("Top1").innerHTML="India";
                document.getElementById("Top2").innerHTML="Mexico";
                document.getElementById("Top3").innerHTML="Russia";
                document.getElementById("Top4").innerHTML="China";
                document.getElementById("Top5").innerHTML="Bangladesh";
                $('#Top1').click(function(){
                    update(India2010);
                });
                $('#Top2').click(function(){
                    update(Mexico2010);
                });
                $('#Top3').click(function(){
                    update(Russia2010);
                });
                $('#Top4').click(function(){
                    update(China2010);
                });
                $('#Top5').click(function(){
                    update(Bangladesh2010);
                });
			});

			$('#button_2005').click(function(){
				show_2005(0,63);
                document.getElementById("Top1").innerHTML="Mexico";
                document.getElementById("Top2").innerHTML="Russia";
                document.getElementById("Top3").innerHTML="India";
                document.getElementById("Top4").innerHTML="China";
                document.getElementById("Top5").innerHTML="Ukraine";
                $('#Top1').click(function(){
                    update(Mexico2005);
                });
                $('#Top2').click(function(){
                    update(Russia2005);
                });
                $('#Top3').click(function(){
                    update(India2005);
                });
                $('#Top4').click(function(){
                    update(China2005);
                });
                $('#Top5').click(function(){
                    update(Ukraine2005);
                });
			});

			$('#button_2000').click(function(){
				show_2000(0,56);
                document.getElementById("Top1").innerHTML="Russia";
                document.getElementById("Top2").innerHTML="Mexico";
                document.getElementById("Top3").innerHTML="India";
                document.getElementById("Top4").innerHTML="China";
                document.getElementById("Top5").innerHTML="Ukraine";
                $('#Top1').click(function(){
                    update(Russia2000);
                });
                $('#Top2').click(function(){
                    update(Mexico2000);
                });
                $('#Top3').click(function(){
                    update(India2000);
                });
                $('#Top4').click(function(){
                    update(China2000);
                });
                $('#Top5').click(function(){
                    update(Ukraine2000);
                });
			});

			$('#button_1995').click(function(){
				show_1995(0,52);
                document.getElementById("Top1").innerHTML="Russia";
                document.getElementById("Top2").innerHTML="India";
                document.getElementById("Top3").innerHTML="Mexico";
                document.getElementById("Top4").innerHTML="Ukraine";
                document.getElementById("Top5").innerHTML="Bangladesh";
                $('#Top1').click(function(){
                    update(Russia1995);
                });
                $('#Top2').click(function(){
                    update(India1995);
                });
                $('#Top3').click(function(){
                    update(Mexico1995);
                });
                $('#Top4').click(function(){
                    update(Ukraine1995);
                });
                $('#Top5').click(function(){
                    update(Bangladesh1995);
                });
			});

			$('#button_1990').click(function(){
				show_1990(0,45);
                document.getElementById("Top1").innerHTML="Russia";
                document.getElementById("Top2").innerHTML="Afghanistan";
                document.getElementById("Top3").innerHTML="India";
                document.getElementById("Top4").innerHTML="Ukraine";
                document.getElementById("Top5").innerHTML="Bangladesh";
                $('#Top1').click(function(){
                    update(Russia1990);
                });
                $('#Top2').click(function(){
                    update(Afghanistan1990);
                });
                $('#Top3').click(function(){
                    update(India1990);
                });
                $('#Top4').click(function(){
                    update(Ukraine1990);
                });
                $('#Top5').click(function(){
                    update(Bangladesh1990);
                });			});

			$('#clean').click(function(){
				clean();
			});
		});

function clean(country){
	g2.selectAll(".china_route").remove();
	g2.selectAll(".label_china").remove();
	g1.selectAll(".ports_china").remove();

	g1.selectAll(".ports_origin").remove();
	g2.selectAll(".label_origin").remove();

	g2.selectAll(".india_route").remove();
	g2.selectAll(".label_india").remove();
	g1.selectAll(".ports_india").remove();

	g2.selectAll(".mexico_route").remove();
	g2.selectAll(".label_mexico").remove();
	g1.selectAll(".ports_mexico").remove();

	g2.selectAll(".russia_route").remove();
	g2.selectAll(".label_russia").remove();
	g1.selectAll(".ports_russia").remove();


	g2.selectAll(".syria_route").remove();
	g2.selectAll(".label_syria").remove();
	g1.selectAll(".ports_syria").remove();

	g2.selectAll(".bangladesh_route").remove();
	g2.selectAll(".label_bangladesh").remove();
	g1.selectAll(".ports_bangladesh").remove();

	g2.selectAll(".ukraine_route").remove();
	g2.selectAll(".label_ukraine").remove();
	g1.selectAll(".ports_ukraine").remove();

}

function show_2020(num1,num2){
	d3.csv("https://raw.githubusercontent.com/OhBlockByJames/D3.js_Project/main/2020.csv", function (error, routes) {
		$('.year-label').text(2020);		
        var data = routes.slice(num1,num2);
		var india = routes.slice(15,32);
		var mexico = routes.slice(33,34);
		var russia = routes.slice(35,46);
		var syria = routes.slice(47,55);
		var maxVolume = d3.max(routes, function(d) { return d.vol; });
		//append china path
		routePath = g2.selectAll(".china_route")//.route
			.data(data)
			.enter()
			.append("path")
			.attr("marker-end", "url(#my-arrow)")
			.attr("class","china_route")
			.attr('d', function(d) {
				var long = parseFloat(d.long);
				var lat = parseFloat(d.lat);
				var destlong = parseFloat(d.longdest);
				var destlat = parseFloat(d.latdest);
				var location=[long,lat];
				var dest=[destlong,destlat];
				return path ({ 
				type:"LineString",
				coordinates: [ location,dest ],
				});
			})
			.style("stroke-width", function(d) { 
				return (d.people/400000);
			})
			.style("stroke",function(d) { 
				if (d.male>d.female){
					return "#2828FF";
				}
				else{
					return "#FF5151";
				}
			})
			.transition().duration(500)
			.style("opacity",function(d) { 
				if (d.people>1000000){
					return 0.6;
				}
				else{
					return 0.1;
				}
			});

		//append china text
		portLabels = g2.selectAll(".label_china")
			.data(data)
			.enter()
			.append("text")
			.attr("x", function(d) { 
				var long = parseFloat(d.long);
				var lat = parseFloat(d.lat);
				var destlong = parseFloat(d.longdest);
				var destlat = parseFloat(d.latdest);
				var longoff=parseFloat(d.longoff);
				var location=[long,lat];
				var dest=[destlong,destlat];
				return projection(dest)[0] 
			})
			.attr("y", function(d) { 
				var destlong = parseFloat(d.longdest);
				var destlat = parseFloat(d.latdest);
				var latoff=parseFloat(d.latoff);
				var dest=[destlong,destlat];
				return projection(dest)[1]
			} )
			.text(function(d) { return d.destination })
			.attr("class","label_china")
			.style("font-size", "2px")
			.style("opacity",0);

		portLabels = g2.selectAll(".label_origin")
			.data(data)
			.enter()
			.append("text")
			.attr("x", function(d) { 
				var long = parseFloat(d.long);
				var lat = parseFloat(d.lat);
				var location=[long,lat];
				return projection(location)[0] 
			})
			.attr("y", function(d) { 
				var long = parseFloat(d.long);
				var lat = parseFloat(d.lat);
				var location=[long,lat];
				return projection(location)[1]
			} )
			.text(function(d) { return d.origin })
			.attr("class","label_origin")
			.style("font-size", "2px")
			.style("opacity",0);
		//append china circles
		portMarkers = g1.selectAll(".ports_china")
			.data(data)
			.enter()
			.append("circle")
			.attr("class","ports_china")
			.attr("cx", function(d) { 
				var destlong = parseFloat(d.longdest);
				var destlat = parseFloat(d.latdest);
				var dest=[destlong,destlat];
				return projection(dest)[0]
			} )
			.attr("cy", function(d) { 
				var destlong = parseFloat(d.longdest);
				var destlat = parseFloat(d.latdest);
				var dest=[destlong,destlat];
				return projection(dest)[1]
			 } )
			.attr("r", function(d) { 
				if (d.people>500000){
					return 1;
				}
				else {
					return 0;
				}
			 })
			.style("fill","black")
			.style("stroke-width",1)
			.style("stroke","#000000")
			.style("opacity",function(d) {
				if (d.people>1000000){
					return 1;
				}
				else{
					return 0.5;
				}
			});

		originMarkers = g1.selectAll(".ports_origin")
			.data(data)
			.enter()
			.append("circle")
			.attr("class","ports_origin")
			.attr("cx", function(d) { 
				var long = parseFloat(d.long);
				var lat = parseFloat(d.lat);
				var origin=[long,lat];
				return projection(origin)[0]
			} )
			.attr("cy", function(d) { 
				var long = parseFloat(d.long);
				var lat = parseFloat(d.lat);
				var origin=[long,lat];
				return projection(origin)[1]
			 } )
			.attr("r", function(d) { 
				if (d.people>8000000){
					return 10;
				}
				else if (d.people>4000000&&d.people<8000000){
					return 8;
				}
				else if (d.people>2000000&&d.people<4000000){
					return 6;
				}
				else if (d.people>1000000&&d.people<2000000){
					return 4;
				}
				else if (d.people>500000&&d.people<1000000){
					return 2;
				}
				else {
					return 0;
				}
			 })
			.style("opacity",function(d) {
				if (d.people>1000000){
					return 1;
				}
				else{
					return 0.5;
				}
			})
			.style("fill",function(d) { 
				if(d.origin=="China"||d.origin=="Mexico"||d.origin=="Syria"||d.origin=="Russia"||
					d.origin=="India"){
					return "#FF8000";
				}
				else{
					return "#FFD306";
				}
			 })
	});
		}

function show_2015(num1,num2){
	d3.csv("https://raw.githubusercontent.com/OhBlockByJames/D3.js_Project/main/2015.csv", function (error, routes) {
		var data = routes.slice(num1,num2);
		var maxVolume = d3.max(routes, function(d) { return d.vol; });
		//append india path
		routePath = g2.selectAll(".india_route")
			.data(data)
			.enter()
			.append("path")
			.attr("class","india_route")
			.attr("marker-end", "url(#my-arrow)")
			.attr('d', function(d) {
				var long = parseFloat(d.long);
				var lat = parseFloat(d.lat);
				var destlong = parseFloat(d.longdest);
				var destlat = parseFloat(d.latdest);
				var location=[long,lat];
				var dest=[destlong,destlat];
				return path ({ 
				type:"LineString",
				coordinates: [ location,dest ],
				});
			})
			.style("stroke-width", function(d) { 
				return (d.people/500000);
			})
			.style("stroke",function(d) { 
				if (d.male>d.female){
					return "#2828FF";
				}
				else{
					return "#FF5151";
				}
			})
			.transition().duration(500)
			.style("opacity",function(d) { 
				if (d.people>1000000){
					return 0.6;
				}
				else{
					return 0.1;
				}
			});
		//append india text
		portLabels = g2.selectAll(".label_india")
			.data(data)
			.enter()
			.append("text")
			.attr("x", function(d) { 
				var long = parseFloat(d.long);
				var lat = parseFloat(d.lat);
				var destlong = parseFloat(d.longdest);
				var destlat = parseFloat(d.latdest);
				var longoff=parseFloat(d.longoff);
				var location=[long,lat];
				var dest=[destlong,destlat];
				return projection(dest)[0]  
			} )
			.attr("y", function(d) { 
				var destlong = parseFloat(d.longdest);
				var destlat = parseFloat(d.latdest);
				var latoff=parseFloat(d.latoff);
				var dest=[destlong,destlat];
				return projection(dest)[1] 
			} )
			.text(function(d) { return d.destination })
			.attr("class","label_india")
			.style("font-size", "2px")
			.style("opacity",0);

		portLabels = g2.selectAll(".label_origin")
			.data(data)
			.enter()
			.append("text")
			.attr("x", function(d) { 
				var long = parseFloat(d.long);
				var lat = parseFloat(d.lat);
				var location=[long,lat];
				return projection(location)[0] 
			})
			.attr("y", function(d) { 
				var long = parseFloat(d.long);
				var lat = parseFloat(d.lat);
				var location=[long,lat];
				return projection(location)[1]
			} )
			.text(function(d) { return d.origin })
			.attr("class","label_origin")
			.style("font-size", "2px")
			.style("opacity",0);
		//append india circles
		portMarkers = g1.selectAll(".ports_india")
			.data(data)
			.enter()
			.append("circle")
			.attr("class","ports_india")
			.attr("cx", function(d) { 
				var destlong = parseFloat(d.longdest);
				var destlat = parseFloat(d.latdest);
				var dest=[destlong,destlat];
				return projection(dest)[0]
			} )
			.attr("cy", function(d) { 
				var destlong = parseFloat(d.longdest);
				var destlat = parseFloat(d.latdest);
				var dest=[destlong,destlat];
				return projection(dest)[1]
			} )
			.attr("r", function(d) { 
				if (d.people>500000){
					return 1;
				}
				else {
					return 0;
				}
			 })
			.style("fill","black")
			.style("stroke-width",1)
			.style("stroke","#000000")
			.style("opacity",function(d) {
				if (d.people>1000000){
					return 1;
				}
				else{
					return 0.5;
				}
			});
		originMarkers = g1.selectAll(".ports_origin")
			.data(data)
			.enter()
			.append("circle")
			.attr("class","ports_origin")
			.attr("cx", function(d) { 
				var long = parseFloat(d.long);
				var lat = parseFloat(d.lat);
				var origin=[long,lat];
				return projection(origin)[0]
			} )
			.attr("cy", function(d) { 
				var long = parseFloat(d.long);
				var lat = parseFloat(d.lat);
				var origin=[long,lat];
				return projection(origin)[1]
			 } )
			.attr("r", function(d) { 
				if (d.people>8000000){
					return 10;
				}
				else if (d.people>4000000&&d.people<8000000){
					return 8;
				}
				else if (d.people>2000000&&d.people<4000000){
					return 6;
				}
				else if (d.people>1000000&&d.people<2000000){
					return 4;
				}
				else if (d.people>500000&&d.people<1000000){
					return 2;
				}
				else {
					return 0;
				}
			 })
			.style("opacity",function(d) {
				if (d.people>1000000){
					return 1;
				}
				else{
					return 0.5;
				}
			})
			.style("fill",function(d) { 
				if(d.origin=="China"||d.origin=="Mexico"||d.origin=="Bangladesh"||d.origin=="Russia"||
					d.origin=="India"){
					return "#FF8000";
				}
				else{
					return "#FFD306";
				}
			 })
	});
		}
function show_2010(num1,num2){
	d3.csv("https://raw.githubusercontent.com/OhBlockByJames/D3.js_Project/main/2010.csv", function (error, routes) {
		var data = routes.slice(num1,num2);

		var maxVolume = d3.max(routes, function(d) { return d.vol; });

		routePath = g2.selectAll(".mexico_route")//.route
			.data(data)
			.enter()
			.append("path")
			.attr("class","mexico_route")
			.attr("marker-end", "url(#my-arrow)")
			.attr('d', function(d) {
				var long = parseFloat(d.long);
				var lat = parseFloat(d.lat);
				var destlong = parseFloat(d.longdest);
				var destlat = parseFloat(d.latdest);
				var location=[long,lat];
				var dest=[destlong,destlat];
				return path ({ 
				type:"LineString",
				coordinates: [ location,dest ],
				});
			})
			.style("stroke-width", function(d) { 
				return (d.people/500000);
			})
			.style("stroke",function(d) { 
				if (d.male>d.female){
					return "#2828FF";
				}
				else{
					return "#FF5151";
				}
			})
			.transition().duration(500)
			.style("opacity",function(d) { 
				if (d.people>1000000){
					return 0.6;
				}
				else{
					return 0.1;
				}
			});

		portLabels = g2.selectAll(".label_mexico")
			.data(data)
			.enter()
			.append("text")
			.attr("x", function(d) { 
				var long = parseFloat(d.long);
				var lat = parseFloat(d.lat);
				var destlong = parseFloat(d.longdest);
				var destlat = parseFloat(d.latdest);
				var longoff=parseFloat(d.longoff);
				var location=[long,lat];
				var dest=[destlong,destlat];
				return projection(dest)[0] 
			})
			.attr("y", function(d) { 
				var destlong = parseFloat(d.longdest);
				var destlat = parseFloat(d.latdest);
				var latoff=parseFloat(d.latoff);
				var dest=[destlong,destlat];
				return projection(dest)[1]
			} )
			.text(function(d) { return d.destination })
			.attr("class","label_mexico")
			.style("font-size", "2px")
			.style("opacity",0);

		portLabels = g2.selectAll(".label_origin")
			.data(data)
			.enter()
			.append("text")
			.attr("x", function(d) { 
				var long = parseFloat(d.long);
				var lat = parseFloat(d.lat);
				var location=[long,lat];
				return projection(location)[0] 
			})
			.attr("y", function(d) { 
				var long = parseFloat(d.long);
				var lat = parseFloat(d.lat);
				var location=[long,lat];
				return projection(location)[1]
			} )
			.text(function(d) { return d.origin })
			.attr("class","label_origin")
			.style("font-size", "2px")
			.style("opacity",0);
		portMarkers = g1.selectAll(".ports_mexico")
			.data(data)
			.enter()
			.append("circle")
			.attr("class","ports_mexico")
			.attr("cx", function(d) { 
				var destlong = parseFloat(d.longdest);
				var destlat = parseFloat(d.latdest);
				var dest=[destlong,destlat];
				return projection(dest)[0]
			} )
			.attr("cy", function(d) { 
				var destlong = parseFloat(d.longdest);
				var destlat = parseFloat(d.latdest);
				var dest=[destlong,destlat];
				return projection(dest)[1]
			 } )
			.attr("r", function(d) { 
				if (d.people>500000){
					return 1;
				}
				else {
					return 0;
				}
			 })
			.style("fill","black")
			.style("stroke-width",1)
			.style("stroke","#000000")
			.style("opacity",function(d) {
				if (d.people>1000000){
					return 1;
				}
				else{
					return 0.5;
				}
			});

		originMarkers = g1.selectAll(".ports_origin")
			.data(data)
			.enter()
			.append("circle")
			.attr("class","ports_origin")
			.attr("cx", function(d) { 
				var long = parseFloat(d.long);
				var lat = parseFloat(d.lat);
				var origin=[long,lat];
				return projection(origin)[0]
			} )
			.attr("cy", function(d) { 
				var long = parseFloat(d.long);
				var lat = parseFloat(d.lat);
				var origin=[long,lat];
				return projection(origin)[1]
			 } )
			.attr("r", function(d) { 
				if (d.people>8000000){
					return 10;
				}
				else if (d.people>4000000&&d.people<8000000){
					return 8;
				}
				else if (d.people>2000000&&d.people<4000000){
					return 6;
				}
				else if (d.people>1000000&&d.people<2000000){
					return 4;
				}
				else if (d.people>500000&&d.people<1000000){
					return 2;
				}
				else {
					return 0;
				}
			 })
			.style("opacity",function(d) {
				if (d.people>1000000){
					return 1;
				}
				else{
					return 0.5;
				}
			})
			.style("fill",function(d) { 
				if(d.origin=="China"||d.origin=="Mexico"||d.origin=="Bangladesh"||d.origin=="Russia"||
					d.origin=="India"){
					return "#FF8000";
				}
				else{
					return "#FFD306";
				}
			 })
	});
		}

function show_2005(num1,num2){
		d3.csv("https://raw.githubusercontent.com/OhBlockByJames/D3.js_Project/main/2005.csv", function (error, routes) {
		var data = routes.slice(num1,num2);

		var maxVolume = d3.max(routes, function(d) { return d.vol; });
		//append china path
		routePath = g2.selectAll(".russia_route")//.route
			.data(data)
			.enter()
			.append("path")
			.attr("class","russia_route")
			.attr("marker-end", "url(#my-arrow)")
			.attr('d', function(d) {
				var long = parseFloat(d.long);
				var lat = parseFloat(d.lat);
				var destlong = parseFloat(d.longdest);
				var destlat = parseFloat(d.latdest);
				var location=[long,lat];
				var dest=[destlong,destlat];
				return path ({ 
				type:"LineString",
				coordinates: [ location,dest ],
				});
			})
			.style("stroke-width", function(d) { 
				return (d.people/500000);
			})
			.style("stroke",function(d) { 
				if (d.male>d.female){
					return "#2828FF";
				}
				else{
					return "#FF5151";
				}
			})
			.transition().duration(500)
			.style("opacity",function(d) { 
				if (d.people>1000000){
					return 0.6;
				}
				else{
					return 0.1;
				}
			});

		portLabels = g2.selectAll(".label_russia")
			.data(data)
			.enter()
			.append("text")
			.attr("x", function(d) { 
				var long = parseFloat(d.long);
				var lat = parseFloat(d.lat);
				var destlong = parseFloat(d.longdest);
				var destlat = parseFloat(d.latdest);
				var longoff=parseFloat(d.longoff);
				var location=[long,lat];
				var dest=[destlong,destlat];
				return projection(dest)[0]
			})
			.attr("y", function(d) { 
				var destlong = parseFloat(d.longdest);
				var destlat = parseFloat(d.latdest);
				var latoff=parseFloat(d.latoff);
				var dest=[destlong,destlat];
				return projection(dest)[1]
			} )
			.text(function(d) { return d.destination })
			.attr("class","label_russia")
			.style("font-size", "2px")
			.style("opacity",0);
		portLabels = g2.selectAll(".label_origin")
			.data(data)
			.enter()
			.append("text")
			.attr("x", function(d) { 
				var long = parseFloat(d.long);
				var lat = parseFloat(d.lat);
				var location=[long,lat];
				return projection(location)[0] 
			})
			.attr("y", function(d) { 
				var long = parseFloat(d.long);
				var lat = parseFloat(d.lat);
				var location=[long,lat];
				return projection(location)[1]
			} )
			.text(function(d) { return d.origin })
			.attr("class","label_origin")
			.style("font-size", "2px")
			.style("opacity",0);
		//append china circles
		portMarkers = g1.selectAll(".ports_russia")
			.data(data)
			.enter()
			.append("circle")
			.attr("class","ports_russia")
			.attr("cx", function(d) { 
				var destlong = parseFloat(d.longdest);
				var destlat = parseFloat(d.latdest);
				var dest=[destlong,destlat];
				return projection(dest)[0]
			} )
			.attr("cy", function(d) { 
				var destlong = parseFloat(d.longdest);
				var destlat = parseFloat(d.latdest);
				var dest=[destlong,destlat];
				return projection(dest)[1]
			 } )
			.attr("r", function(d) { 
				if (d.people>500000){
					return 1;
				}
				else {
					return 0;
				}
			 })
			.style("fill","black")
			.style("stroke-width",1)
			.style("stroke","#000000")
			.style("opacity",function(d) {
				if (d.people>1000000){
					return 1;
				}
				else{
					return 0.5;
				}
			});

		originMarkers = g1.selectAll(".ports_origin")
			.data(data)
			.enter()
			.append("circle")
			.attr("class","ports_origin")
			.attr("cx", function(d) { 
				var long = parseFloat(d.long);
				var lat = parseFloat(d.lat);
				var origin=[long,lat];
				return projection(origin)[0]
			} )
			.attr("cy", function(d) { 
				var long = parseFloat(d.long);
				var lat = parseFloat(d.lat);
				var origin=[long,lat];
				return projection(origin)[1]
			 } )
			.attr("r", function(d) { 
				if (d.people>8000000){
					return 10;
				}
				else if (d.people>4000000&&d.people<8000000){
					return 8;
				}
				else if (d.people>2000000&&d.people<4000000){
					return 6;
				}
				else if (d.people>1000000&&d.people<2000000){
					return 4;
				}
				else if (d.people>500000&&d.people<1000000){
					return 2;
				}
				else {
					return 0;
				}
			 })
			.style("opacity",function(d) {
				if (d.people>1000000){
					return 1;
				}
				else{
					return 0.5;
				}
			})
			.style("fill",function(d) { 
				if(d.origin=="China"||d.origin=="Mexico"||d.origin=="Ukraine"||d.origin=="Russia"||
					d.origin=="India"){
					return "#FF8000";
				}
				else{
					return "#FFD306";
				}
			 })
	});
		}

function show_2000(num1,num2){
		d3.csv("https://raw.githubusercontent.com/OhBlockByJames/D3.js_Project/main/2000.csv", function (error, routes) {
		var data = routes.slice(num1,num2);

		var maxVolume = d3.max(routes, function(d) { return d.vol; });
		routePath = g2.selectAll(".syria_route")//.route
			.data(data)
			.enter()
			.append("path")
			.attr("class","syria_route")
			.attr("marker-end", "url(#my-arrow)")
			.attr('d', function(d) {
				var long = parseFloat(d.long);
				var lat = parseFloat(d.lat);
				var destlong = parseFloat(d.longdest);
				var destlat = parseFloat(d.latdest);
				var location=[long,lat];
				var dest=[destlong,destlat];
				return path ({ 
				type:"LineString",
				coordinates: [ location,dest ],
				});
			})
			.style("stroke-width", function(d) { 
				return (d.people/500000);
			})
			.style("stroke",function(d) { 
				if (d.male>d.female){
					return "#2828FF";
				}
				else{
					return "#FF5151";
				}
			})
			.transition().duration(500)
			.style("opacity",function(d) { 
				if (d.people>1000000){
					return 0.6;
				}
				else{
					return 0.1;
				}
			});

		portLabels = g2.selectAll(".label_syria")
			.data(data)
			.enter()
			.append("text")
			.attr("x", function(d) { 
				var long = parseFloat(d.long);
				var lat = parseFloat(d.lat);
				var destlong = parseFloat(d.longdest);
				var destlat = parseFloat(d.latdest);
				var longoff=parseFloat(d.longoff);
				var location=[long,lat];
				var dest=[destlong,destlat];
				return projection(dest)[0] 
			})
			.attr("y", function(d) { 
				var destlong = parseFloat(d.longdest);
				var destlat = parseFloat(d.latdest);
				var latoff=parseFloat(d.latoff);
				var dest=[destlong,destlat];
				return projection(dest)[1]
			} )
			.text(function(d) { return d.destination })
			.attr("class","label_syria")
			.style("font-size", "2px")
			.style("opacity",0);

		portLabels = g2.selectAll(".label_origin")
			.data(data)
			.enter()
			.append("text")
			.attr("x", function(d) { 
				var long = parseFloat(d.long);
				var lat = parseFloat(d.lat);
				var location=[long,lat];
				return projection(location)[0] 
			})
			.attr("y", function(d) { 
				var long = parseFloat(d.long);
				var lat = parseFloat(d.lat);
				var location=[long,lat];
				return projection(location)[1]
			} )
			.text(function(d) { return d.origin })
			.attr("class","label_origin")
			.style("font-size", "2px")
			.style("opacity",0);
		//append china circles
		portMarkers = g1.selectAll(".ports_syria")
			.data(data)
			.enter()
			.append("circle")
			.attr("class","ports_syria")
			.attr("cx", function(d) { 
				var destlong = parseFloat(d.longdest);
				var destlat = parseFloat(d.latdest);
				var dest=[destlong,destlat];
				return projection(dest)[0]
			} )
			.attr("cy", function(d) { 
				var destlong = parseFloat(d.longdest);
				var destlat = parseFloat(d.latdest);
				var dest=[destlong,destlat];
				return projection(dest)[1]
			 } )
			.attr("r", function(d) { 
				if (d.people>500000){
					return 1;
				}
				else {
					return 0;
				}
			 })
			.style("fill","black")
			.style("stroke-width",1)
			.style("stroke","#000000")
			.style("opacity",function(d) {
				if (d.people>1000000){
					return 1;
				}
				else{
					return 0.5;
				}
			});

		originMarkers = g1.selectAll(".ports_origin")
			.data(data)
			.enter()
			.append("circle")
			.attr("class","ports_origin")
			.attr("cx", function(d) { 
				var long = parseFloat(d.long);
				var lat = parseFloat(d.lat);
				var origin=[long,lat];
				return projection(origin)[0]
			} )
			.attr("cy", function(d) { 
				var long = parseFloat(d.long);
				var lat = parseFloat(d.lat);
				var origin=[long,lat];
				return projection(origin)[1]
			 } )
			.attr("r", function(d) { 
				if (d.people>8000000){
					return 10;
				}
				else if (d.people>4000000&&d.people<8000000){
					return 8;
				}
				else if (d.people>2000000&&d.people<4000000){
					return 6;
				}
				else if (d.people>1000000&&d.people<2000000){
					return 4;
				}
				else if (d.people>500000&&d.people<1000000){
					return 2;
				}
				else {
					return 0;
				}
			 })
			.style("opacity",function(d) {
				if (d.people>1000000){
					return 1;
				}
				else{
					return 0.5;
				}
			})
			.style("fill",function(d) { 
				if(d.origin=="China"||d.origin=="Mexico"||d.origin=="Ukraine"||d.origin=="Russia"||
					d.origin=="India"){
					return "#FF8000";
				}
				else{
					return "#FFD306";
				}
			 })
	});
		}

function show_1995(num1,num2){
		d3.csv("https://raw.githubusercontent.com/OhBlockByJames/D3.js_Project/main/1995.csv", function (error, routes) {
		var data = routes.slice(num1,num2);

		var maxVolume = d3.max(routes, function(d) { return d.vol; });
		routePath = g2.selectAll(".bangladesh_route")//.route
			.data(data)
			.enter()
			.append("path")
			.attr("class","bangladesh_route")
			.attr("marker-end", "url(#my-arrow)")
			.attr('d', function(d) {
				var long = parseFloat(d.long);
				var lat = parseFloat(d.lat);
				var destlong = parseFloat(d.longdest);
				var destlat = parseFloat(d.latdest);
				var location=[long,lat];
				var dest=[destlong,destlat];
				return path ({ 
				type:"LineString",
				coordinates: [ location,dest ],
				});
			})
			.style("stroke-width", function(d) { 
				return (d.people/500000);
			})
			.style("stroke",function(d) { 
				if (d.male>d.female){
					return "#2828FF";
				}
				else{
					return "#FF5151";
				}
			})
			.transition().duration(500)
			.style("opacity",function(d) { 
				if (d.people>1000000){
					return 0.6;
				}
				else{
					return 0.1;
				}
			});
		//append text
		portLabels = g2.selectAll(".label_bangladesh")
			.data(data)
			.enter()
			.append("text")
			.attr("x", function(d) { 
				var long = parseFloat(d.long);
				var lat = parseFloat(d.lat);
				var destlong = parseFloat(d.longdest);
				var destlat = parseFloat(d.latdest);
				var longoff=parseFloat(d.longoff);
				var location=[long,lat];
				var dest=[destlong,destlat];
				return projection(dest)[0]
			})
			.attr("y", function(d) { 
				var destlong = parseFloat(d.longdest);
				var destlat = parseFloat(d.latdest);
				var latoff=parseFloat(d.latoff);
				var dest=[destlong,destlat];
				return projection(dest)[1]
			} )
			.text(function(d) { return d.destination })
			.attr("class","label_bangladesh")
			.style("font-size", "2px")
			.style("opacity",0);
		portLabels = g2.selectAll(".label_origin")
			.data(data)
			.enter()
			.append("text")
			.attr("x", function(d) { 
				var long = parseFloat(d.long);
				var lat = parseFloat(d.lat);
				var location=[long,lat];
				return projection(location)[0] 
			})
			.attr("y", function(d) { 
				var long = parseFloat(d.long);
				var lat = parseFloat(d.lat);
				var location=[long,lat];
				return projection(location)[1]
			} )
			.text(function(d) { return d.origin })
			.attr("class","label_origin")
			.style("font-size", "2px")
			.style("opacity",0);
		//append circles
		portMarkers = g1.selectAll(".ports_bangladesh")
			.data(data)
			.enter()
			.append("circle")
			.attr("class","ports_bangladesh")
			.attr("cx", function(d) { 
				var destlong = parseFloat(d.longdest);
				var destlat = parseFloat(d.latdest);
				var dest=[destlong,destlat];
				return projection(dest)[0]
			} )
			.attr("cy", function(d) { 
				var destlong = parseFloat(d.longdest);
				var destlat = parseFloat(d.latdest);
				var dest=[destlong,destlat];
				return projection(dest)[1]
			 } )
			.attr("r", function(d) { 
				if (d.people>500000){
					return 1;
				}
				else {
					return 0;
				}
			 })
			.style("fill","black")
			.style("stroke-width",1)
			.style("stroke","#000000")
			.style("opacity",function(d) {
				if (d.people>1000000){
					return 1;
				}
				else{
					return 0.5;
				}
			});
		originMarkers = g1.selectAll(".ports_origin")
			.data(data)
			.enter()
			.append("circle")
			.attr("class","ports_origin")
			.attr("cx", function(d) { 
				var long = parseFloat(d.long);
				var lat = parseFloat(d.lat);
				var origin=[long,lat];
				return projection(origin)[0]
			} )
			.attr("cy", function(d) { 
				var long = parseFloat(d.long);
				var lat = parseFloat(d.lat);
				var origin=[long,lat];
				return projection(origin)[1]
			 } )
			.attr("r", function(d) { 
				if (d.people>8000000){
					return 10;
				}
				else if (d.people>4000000&&d.people<8000000){
					return 8;
				}
				else if (d.people>2000000&&d.people<4000000){
					return 6;
				}
				else if (d.people>1000000&&d.people<2000000){
					return 4;
				}
				else if (d.people>500000&&d.people<1000000){
					return 2;
				}
				else {
					return 0;
				}
			 })
			.style("opacity",function(d) {
				if (d.people>1000000){
					return 1;
				}
				else{
					return 0.5;
				}
			})
			.style("fill",function(d) { 
				if(d.origin=="Bangladesh"||d.origin=="Mexico"||d.origin=="Ukraine"||d.origin=="Russia"||
					d.origin=="India"){
					return "#FF8000";
				}
				else{
					return "#FFD306";
				}
			 })
	});
		}

function show_1990(num1,num2){
		d3.csv("https://raw.githubusercontent.com/OhBlockByJames/D3.js_Project/main/1990.csv", function (error, routes) {
		var data = routes.slice(num1,num2);


		var maxVolume = d3.max(routes, function(d) { return d.vol; });
		routePath = g2.selectAll(".ukraine_route")//.route
			.data(data)
			.enter()
			.append("path")
			.attr("class","ukraine_route")
			.attr("marker-end", "url(#my-arrow)")
			.attr('d', function(d) {
				var long = parseFloat(d.long);
				var lat = parseFloat(d.lat);
				var destlong = parseFloat(d.longdest);
				var destlat = parseFloat(d.latdest);
				var location=[long,lat];
				var dest=[destlong,destlat];
				return path ({ 
				type:"LineString",
				coordinates: [ location,dest ],
				});
			})
			.style("stroke-width", function(d) { 
				return (d.people/500000);
			})
			.style("stroke",function(d) { 
				if (d.male>d.female){
					return "#2828FF";
				}
				else{
					return "#FF5151";
				}
			})
			.transition().duration(500)
			.style("opacity",function(d) { 
				if (d.people>1000000){
					return 0.6;
				}
				else{
					return 0.1;
				}
			});
		//append text
		portLabels = g2.selectAll(".label_ukraine")
			.data(data)
			.enter()
			.append("text")
			.attr("x", function(d) { 
				var long = parseFloat(d.long);
				var lat = parseFloat(d.lat);
				var destlong = parseFloat(d.longdest);
				var destlat = parseFloat(d.latdest);
				var longoff=parseFloat(d.longoff);
				var location=[long,lat];
				var dest=[destlong,destlat];
				return projection(dest)[0]
			})
			.attr("y", function(d) { 
				var destlong = parseFloat(d.longdest);
				var destlat = parseFloat(d.latdest);
				var latoff=parseFloat(d.latoff);
				var dest=[destlong,destlat];
				return projection(dest)[1]
			} )
			.text(function(d) { return d.destination })
			.attr("class","label_ukraine")
			.style("font-size", "2px")
			.style("opacity",0);

		portLabels = g2.selectAll(".label_origin")
			.data(data)
			.enter()
			.append("text")
			.attr("x", function(d) { 
				var long = parseFloat(d.long);
				var lat = parseFloat(d.lat);
				var location=[long,lat];
				return projection(location)[0] 
			})
			.attr("y", function(d) { 
				var long = parseFloat(d.long);
				var lat = parseFloat(d.lat);
				var location=[long,lat];
				return projection(location)[1]
			} )
			.text(function(d) { return d.origin })
			.attr("class","label_origin")
			.style("font-size", "2px")
			.style("opacity",0);
		//append circles
		portMarkers = g1.selectAll(".ports_ukraine")
			.data(data)
			.enter()
			.append("circle")
			.attr("class","ports_ukraine")
			.attr("cx", function(d) { 
				var destlong = parseFloat(d.longdest);
				var destlat = parseFloat(d.latdest);
				var dest=[destlong,destlat];
				return projection(dest)[0]
			} )
			.attr("cy", function(d) { 
				var destlong = parseFloat(d.longdest);
				var destlat = parseFloat(d.latdest);
				var dest=[destlong,destlat];
				return projection(dest)[1]
			 } )
			.attr("r", function(d) { 
				if (d.people>500000){
					return 1;
				}
				else {
					return 0;
				}
			 })
			.style("fill","black")
			.style("stroke-width",1)
			.style("stroke","#000000")
			.style("opacity",function(d) {
				if (d.people>1000000){
					return 1;
				}
				else{
					return 0.5;
				}
			});
		originMarkers = g1.selectAll(".ports_origin")
			.data(data)
			.enter()
			.append("circle")
			.attr("class","ports_origin")
			.attr("cx", function(d) { 
				var long = parseFloat(d.long);
				var lat = parseFloat(d.lat);
				var origin=[long,lat];
				return projection(origin)[0]
			} )
			.attr("cy", function(d) { 
				var long = parseFloat(d.long);
				var lat = parseFloat(d.lat);
				var origin=[long,lat];
				return projection(origin)[1]
			 } )
			.attr("r", function(d) { 
				if (d.people>8000000){
					return 10;
				}
				else if (d.people>4000000&&d.people<8000000){
					return 8;
				}
				else if (d.people>2000000&&d.people<4000000){
					return 6;
				}
				else if (d.people>1000000&&d.people<2000000){
					return 4;
				}
				else if (d.people>500000&&d.people<1000000){
					return 2;
				}
				else {
					return 0;
				}
			 })
			.style("opacity",function(d) {
				if (d.people>1000000){
					return 1;
				}
				else{
					return 0.5;
				}
			})
			.style("fill",function(d) { 
				if(d.origin=="Bangladesh"||d.origin=="Afghanistan"||d.origin=="Ukraine"||d.origin=="Russia"||
					d.origin=="India"){
					return "#FF8000";
				}
				else{
					return "#FFD306";
				}
			 })
	});
		}
//d3.js part
var width = 1000; var height = 500;//950*650
var projection = d3.geoKavrayskiy7()
	.scale(160)//180
	.rotate([-150,0])
	.translate([width/2,height/2])
	.precision(0.1);
var path = d3.geoPath().projection(projection);
var svg = d3.select("#map").append("svg")
	.attr("width", width)
	.attr("height", height);
var zoom = d3.zoom()
	.scaleExtent([1,10])
	.on("zoom", zoomed);

var arrow = d3.arrow5()
	.id("my-arrow")
	.attr("class","arrows")
	.attr("fill", "none")
	.attr("stroke", "black");

svg.call(zoom);
svg.call(arrow);

function zoomed() {
	svg
	.selectAll('path') // To prevent stroke width from scaling
	.style('opacity',0.5)
	.attr('transform', d3.event.transform);

	svg
	.selectAll('rect') // To prevent stroke width from scaling
	.style('opacity',1)
	.attr('transform', d3.event.transform);

	svg
	.selectAll('text') // To prevent text from scaling
	.style('opacity',1)
	.attr('transform', d3.event.transform);

	svg
	.selectAll('circle') // To prevent circle from scaling
	.style('opacity',0.3)
	.attr('transform', d3.event.transform);

	svg
	.selectAll('.legends') // To prevent circle from scaling
	.style('opacity',1)
	.attr('transform', d3.event.transform);
	}


// Create a few groups to layer elements correctly
var g1 = svg.append("g");  
var g2 = svg.append("g");
var colorScale = d3.scaleThreshold()
//區分人均gdp等級 
	.domain([1000, 4000, 8000, 12000, 30000])
	.range(d3.schemeGreens[6]); 
var gdpdata = d3.map();
var q = d3.queue();
q.defer(d3.json, "https://raw.githubusercontent.com/OhBlockByJames/InternationalMigrant_D3.js/main/map.geojson");
q.defer(d3.csv, "https://raw.githubusercontent.com/OhBlockByJames/D3.js_Project/main/gdp.csv"
, function(d) { gdpdata.set(d.code,+d.gdp );});
q.await(ondraw);

function ondraw(error,dataGeo,data){
//legend
var valuesToShow = [10]
svg
	.selectAll("legend")
	.data(valuesToShow)
	.enter()
	.append("circle")
	.attr("class","legends")
	.attr("cx", 900 )
	.attr("cy", 450 )
	.attr("r", function(d){ return d;})
	.style("fill", "#FF8000")
	.attr("stroke", "none");
svg
	.selectAll("legend")
	.data(valuesToShow)
	.enter()
	.append("circle")
	.attr("class","legends")
	.attr("cx", 950 )
	.attr("cy", 450 )
	.attr("r", function(d){ return d;})
	.style("fill", "#FFD306")
	.attr("stroke", "none");
svg.append("text")
	.attr('x', 920)
	.attr("y", 480)
	.text("橘點:移出人數前五名 黃點:其他國家")
	.attr("text-anchor", "middle")
	.style("font", "10px times")
svg.append("text")
	.attr('x', 882)
	.attr("y", 490)
	.text("黑點:移民移入國家")
	.attr("text-anchor", "middle")
	.style("font", "10px times")
svg
	.append('rect')
	.attr('x', 920)
	.attr('y', 390)
	.attr('height', 2)
	.attr('width', 40)
	.style("fill", "#2828FF")
svg
	.append('rect')
	.attr('x', 920)
	.attr('y', 380)
	.attr('height', 2)
	.attr('width', 40)
	.style("fill", "#FF5151")
svg.append("text")
	.attr('x', 840)
	.attr("y", 410)
	.text("一百萬人移民 藍線:男多 紅線:女多")
	.attr("text-anchor", "left")
	.style("font", "10px times")



g1.append("g")
	.selectAll("path")
		.data(dataGeo.features)
		.enter().append("path")
		.attr("d", d3.geoPath()
		.projection(projection))
		.style("stroke", "black")
		.style("stroke-width", function(d){
			console.log(d)
			if( d.properties.name =="West Bank"||d.properties.name =="Jordan"||d.properties.name =="Kuwait"
				||d.properties.name =="United Arab Emirates"
				||d.properties.name =="Lebanon"||d.properties.name =="Qatar"
				||d.properties.name =="Estonia"||d.properties.name =="Haiti"
				){
				return 0.3;
			}
			else{
				return 0;
			}
		})
		.attr("fill", function (d) {
		d.total = gdpdata.get(d.id) || 0;
		//兩個有一個是true 即回傳true
		return colorScale(d.total);
		})
		.attr("class", function(d){ return "Country" } )
		.style("opacity", 0.7)
		.on("mouseover", mouseOver )
		.on("mouseleave", mouseLeave )
		.on("click", Click )
}

//tooltip
	var tooltip = d3.select("#map")
		.append("div")
		.style("opacity", 1)
		.attr("class", "tooltip")
		.style("background-color", "white")
		.style("border", "solid")
		.style("border-width", "2px")
		.style("border-radius", "5px")
		.style("padding", "5px")






let Click = function(d) {
	console.log(d.properties.name);
	d3.select(this)
		.style("opacity", 0.7)
		// .style("stroke", "blue")
		// .style("stroke-width", 2)
	tooltip
		.style("left", (d3.mouse(this)[0]+70) + "px")
		.style("top", (d3.mouse(this)[1]) + "px")
		.html("Country Name: "+d.properties.name)
		.style("opacity", 1)
    
}


//mouse on map
let mouseOver = function(d) {
	d3.selectAll(".Country")
		.transition()
		.duration(500)
		.style("opacity", 0.3)
		// .style("stroke", "black")
		// .style("stroke-width", 0)//1
	d3.select(this)
		.transition()
		.duration(500)
		.style("opacity", 0.7)
		// .style("stroke", "red")
		// .style("stroke-width", 0)//2
	tooltip
		.style("left", (d3.mouse(this)[0]+70) + "px")
		.style("top", (d3.mouse(this)[1]) + "px")
		.html("Country Name: "+d.properties.name)
		.style("opacity", 1)
}


let mouseLeave = function(d) {
	d3.selectAll(".Country")
		.transition()
		.duration(500)
		.style("opacity", 0.7)
		// .style("stroke", "black")
		// .style("stroke-width", 0)//1
	tooltip
		.style("left", (d3.mouse(this)[0]+70) + "px")
		.style("top", (d3.mouse(this)[1]) + "px")
		.style("opacity", 0)
}





// create 1990 data_set
var Russia1990 = [
   {group: "Ukraine", value: 5018098},
   {group: "Kazakhstan", value: 2474111},
 //  {group: "Uzbekistan", value: 1267201},
   {group: "Belarus", value: 791522},
   {group: "Latvia", value: 473207},
   {group: "Tajikistan", value: 363565},
   {group: "USA", value: 190654}

];

var Afghanistan1990 = [
   {group: "Iran", value: 3980307},
   {group: "Pakistan", value: 3374973},
   {group: "Saudi Arabia", value: 166255}
];

var India1990 = [
   {group: "Pakistan", value: 2818248},
   {group: "Saudi Arabia", value: 906468},
   {group: "USA", value: 450406},
  // {group: "United Arab Emirates", value: 458294},
  {group: "Kuwait", value: 375183},
   {group: "Nepal", value: 369370},
  // {group: "United Kingdom", value: 399526},
   {group: "Oman", value: 152554},
   {group: "Canada", value: 166640}
];
var Ukraine1990 = [
   {group: "Russia", value: 3301922},
   {group: "Poland", value: 438692},
   {group: "Kazakhstan", value: 356063},
   {group: "Belarus", value: 261845},
   {group: "USA", value: 154211},
   {group: "Israel", value: 168081},
   {group: "Moldova", value: 243717},
   {group: "Uzbekistan", value: 180213}
];
var Bangladesh1990 = [
   {group: "India", value: 4375155},
   {group: "Saudi Arabia", value: 479380},
   {group: "United Arab Emirates", value: 154869},
   {group: "Kuwait", value: 126783},
   {group: "United Kingdom", value: 102380}
];


// create 1995 data_set
var Russia1995 = [
   {group: "Ukraine", value: 4355392},
   {group: "Kazakhstan", value: 2253497},
   {group: "Uzbekistan", value: 1161963},
 {group: "Belarus", value: 749767},
   {group: "Germany", value: 490548},
   {group: "Latvia", value: 354000},
   {group: "USA", value: 268967}
];

var India1995 = [
   {group: "Pakistan", value: 2365884},
   {group: "USA", value: 746337},
   {group: "Saudi Arabia", value: 929709},
 //  {group: "United Arab Emirates", value: 667853},
   {group: "Nepal", value: 515578},
 //  {group: "United Kingdom", value: 422284},
   {group: "Kuwait", value: 332377},
   {group: "Oman", value: 282987},
   {group: "Canada", value: 240035}
];
var Mexico1995 = [
   {group: "USA", value: 6827945}
];

var Ukraine1995 = [
   {group: "Russia", value: 3485074},
   {group: "Poland", value: 375267},
   {group: "Kazakhstan", value: 302168},
   {group: "Belarus", value: 248032},
   {group: "USA", value: 217555},
   {group: "Israel", value: 170963},
   {group: "Moldova", value: 164474},
   {group: "Uzbekistan", value: 153360}
];
var Bangladesh1995 = [
   {group: "India", value: 4127135},
   {group: "Saudi Arabia", value: 491297},
   {group: "United Arab Emirates", value: 219911},
   {group: "Kuwait", value: 110044},
   {group: "United Kingdom", value: 124761}
];

// create 2000 data_set
var Russia2000 = [
   {group: "Ukraine", value: 3745842},
   {group: "Kazakhstan", value: 2032883},
 //  {group: "Uzbekistan", value: 1067247},
   {group: "Germany", value: 903777},
   {group: "Belarus", value: 708011},
   {group: "USA", value: 348815},
   {group: "Tajikistan", value: 252099},
   {group: "Latvia", value: 234753}
];

var India2000 = [
   {group: "Pakistan", value: 2101039},
   {group: "USA", value: 1048517},
   {group: "Saudi Arabia", value: 978992},
//   {group: "United Arab Emirates", value: 915878},
   {group: "Nepal", value: 543594},
  // {group: "United Kingdom", value: 452144},
   {group: "Kuwait", value: 418664},
   {group: "Oman", value: 333881},
   {group: "Canada", value: 319138}
];
var Mexico2000 = [
   {group: "USA", value: 9410529},
];

var Ukraine2000 = [
   {group: "Russia", value: 3541839},
   {group: "Poland", value: 321013},
   {group: "Kazakhstan", value: 248273},
   {group: "Belarus", value: 234219},
   {group: "USA", value: 282139},
   {group: "Israel", value: 164271},
   {group: "Moldova", value: 111007},
   {group: "Uzbekistan", value: 131027}
];
var China2000 = [
   {group: "USA", value: 1348465},
   {group: "Canada", value: 412162},
   {group: "Japan", value: 335600},
   {group: "Singapore", value: 250198},
   {group: "Australia", value: 144690},
   {group: "United Kingdom", value: 144073}

];


// create 2005 data_set
var Russia2005 = [
   {group: "Ukraine", value: 3422713},
   {group: "Kazakhstan", value: 2122379},
 //  {group: "Uzbekistan", value: 980674},
   {group: "Germany", value: 889324},
   {group: "Belarus", value: 698192},
   {group: "USA", value: 371254},
   {group: "Tajikistan", value: 238699},
   {group: "Latvia", value: 201748}
];

var India2005 = [
   {group: "Pakistan", value: 1998814},
   {group: "USA", value: 1390605},
 //  {group: "Saudi Arabia", value: 1216549},
   {group: "Nepal", value: 514650},
   {group: "Kuwait", value: 485921},
   {group: "Canada", value: 424855},
   {group: "Oman", value: 373411}
];
var Mexico2005 = [
   {group: "USA", value: 10611064},
];

var Ukraine2005 = [
   {group: "Russia", value: 3293929},
   {group: "USA", value: 298766},
   {group: "Kazakhstan", value: 283038},
   {group: "Poland", value: 263473},
   {group: "Belarus", value: 230971},
   {group: "Germany", value: 186103},
   {group: "Israel", value: 146749},
   {group: "Uzbekistan", value: 132963}
];
var China2005 = [
   {group: "USA", value: 1607654},
   {group: "Japan", value: 648120},
   {group: "Canada", value: 508994},
   {group: "Singapore", value: 299651},
   {group: "Australia", value: 227561},
   {group: "United Kingdom", value: 146994}

];


// create 2010 data_set
var Russia2010 = [
   {group: "Ukraine", value: 3265811},
   {group: "Kazakhstan", value: 2211875},
 //  {group: "Uzbekistan", value: 913652},
   {group: "Germany", value: 857226},
   {group: "Belarus", value: 688372},
   {group: "USA", value: 405679},
   {group: "Tajikistan", value: 238142},
   {group: "Latvia", value: 163606}
];

var India2010 = [
   {group: "United Arab Emirates", value: 2913858},
 //  {group: "Pakistan", value: 1943345},
   {group: "USA", value: 1784284},
   {group: "Saudi Arabia", value: 1579235},
   {group: "Kuwait", value: 675347},
   {group: "Oman", value: 473206},
   {group: "Nepal", value: 461186},
];
var Mexico2010 = [
   {group: "USA", value: 12168662},
];
var Bangladesh2010 = [
   {group: "India", value: 2855334},
   {group: "United Arab Emirates", value: 919365},
   {group: "Saudi Arabia", value: 808485},
   {group: "Malaysia", value: 351422},
   {group: "Kuwait", value: 258071},
   {group: "United Kingdom", value: 209581},
   {group: "Qatar", value: 169370},
   {group: "USA", value: 159527}
];
var China2010 = [
   {group: "USA", value: 1922950},
   {group: "Japan", value: 687156},
   {group: "Canada", value: 611990},
   {group: "Australia", value: 371550},
   {group: "Singapore", value: 365797},
   {group: "United Kingdom", value: 155196}

];


// create 2015 data_set
var Russia2015 = [
   {group: "Ukraine", value: 3275758},
   {group: "Kazakhstan", value: 2352598},
 //  {group: "Uzbekistan", value: 877690},
   {group: "Germany", value: 876302},
   {group: "Belarus", value: 682362},
   {group: "USA", value: 386529},
   {group: "Tajikistan", value: 234154},
   {group: "Latvia", value: 136376}
];

var India2015 = [
   {group: "United Arab Emirates", value: 3184043},
   {group: "USA", value: 2389639},
   {group: "Saudi Arabia", value: 2003256},
   {group: "Kuwait", value: 1061758},
   {group: "Oman", value: 1076151},
   {group: "Canada", value: 664465}
];
var Mexico2015 = [
   {group: "USA", value: 11643298},
];

var Bangladesh2015 = [
   {group: "India", value: 2660632},
  // {group: "United Arab Emirates", value: 1004611},
   {group: "Saudi Arabia", value: 1022812},
   {group: "Malaysia", value: 392295},
   {group: "Kuwait", value: 350229},
   {group: "United Kingdom", value: 215649},
   {group: "Qatar", value: 160183},
  // {group: "USA", value: 222616}
];
var China2015 = [
   {group: "USA", value: 2676697},
   {group: "Japan", value: 714570},
   {group: "Canada", value: 645278},
   {group: "Australia", value: 508870},
   {group: "Singapore", value: 419634},
   {group: "United Kingdom", value: 199428}

];

// create 2020 data_set
var Russia2020 = [
   {group: "Ukraine", value: 3330586},
   {group: "Kazakhstan", value: 2476018},
 //  {group: "Uzbekistan", value: 871047},
   {group: "Germany", value: 1198831},
   {group: "Belarus", value: 672481},
   {group: "USA", value: 397061},
   {group: "Tajikistan", value: 234998},
   {group: "Latvia", value: 116771}
];

var India2020 = [
   {group: "United Arab Emirates", value: 3471300},
 //  {group: "Pakistan", value: 1597134},
   {group: "USA", value: 2723764},
   {group: "Saudi Arabia", value: 2502337},
 //  {group: "United Kingdom", value: 835359},
   {group: "Oman", value: 1375667},
   {group: "Kuwait", value: 1152175},
   {group: "Canada", value: 720083}
];
var Mexico2020 = [
   {group: "USA", value: 10853105},
];

var Syria2020 = [
   {group: "Turkey", value: 3792505},
   {group: "Lebanon", value: 1042785},
   {group: "Saudi Arabia", value: 823261},
 //  {group: "Germany", value: 707457},
   {group: "Jordan", value: 698701},
   {group: "Iraq", value: 254441},
   {group: "Sweden", value: 190882},
   {group: "Egypt", value: 125673}
];
var China2020 = [
   {group: "USA", value: 2184110},   
   {group: "Japan", value: 775893},
   {group: "Canada", value: 699190},
   {group: "Australia", value: 653232},
   {group: "Singapore", value: 426434},
   {group: "United Kingdom", value: 208229}

];


// set the dimensions and margins of the graph
var margin = {top: 30, right: 30, bottom: 70, left: 60},
    width = 460 - margin.left - margin.right,
    height = 400 - margin.top - margin.bottom;

// append the svg object to the body of the page
var svg = d3.select("#my_dataviz")
  .append("svg")
    .attr("width", width + margin.left + margin.right)
    .attr("height", height + margin.top + margin.bottom)
  .append("g")
    .attr("transform",
          "translate(" + margin.left + "," + margin.top + ")");

// Initialize the X axis
var x = d3.scaleBand()
  .range([ 0, width ])
  .padding(0.2);
var xAxis = svg.append("g")
  .attr("transform", "translate(0," + height + ")")

// Initialize the Y axis
var y = d3.scaleLinear()
  .range([ height, 0]);
var yAxis = svg.append("g")
  .attr("class", "myYaxis")


// A function that create / update the plot for a given variable:
function update(data) {

  // Update the X axis
  x.domain(data.map(function(d) { return d.group; }))
  xAxis.call(d3.axisBottom(x))

  // Update the Y axis
  y.domain([0, d3.max(data, function(d) { return d.value }) ]);
  yAxis.transition().duration(1000).call(d3.axisLeft(y));

  // Create the u variable
  var u = svg.selectAll("rect")
    .data(data)

  u
    .enter()
    .append("rect") // Add a new rect for each new elements
    .merge(u) // get the already existing elements as well
    .transition() // and apply changes to all of them
    .duration(1000)
      .attr("x", function(d) { return x(d.group); })
      .attr("y", function(d) { return y(d.value); })
      .attr("width", x.bandwidth())
      .attr("height", function(d) { return height - y(d.value); })
      .attr("fill", "#69b3a2")

  // If less group in the new dataset, I delete the ones not in use anymore
  u
    .exit()
    .remove()
}

// Initialize the plot with the first dataset
update(India2020)



	</script>

</body>
</html>
